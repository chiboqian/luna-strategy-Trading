# TREND RULES - Following the trend (Uptrend + Downtrend)
# Optimized for 1-MINUTE BARS
# RSI 21 = 21 minutes, Z-score 20 = 20 minutes, SMA 50 = 50 min, SMA 200 = 3.3 hours
# Trend cooldown: 10 min (600s)
#
# RULES IN THIS FILE:
# - SPY Uptrend → Buy UPRO
# - SPY Downtrend → Buy SPXU
# - QQQ Uptrend → Buy TQQQ
# - QQQ Downtrend → Buy SQQQ

rules:
  # ============================================================================
  # SPY TREND RULES
  # ============================================================================

  # Trend Monitor: SPY Uptrend (Price > SMA 50 AND SMA 200)
  # Only buy in confirmed uptrend with RSI in neutral zone and not overextended
  - name: "SPY Uptrend"
    symbol: "SPY"
    asset_class: "stock"
    trigger: "bar"
    conditions:
      - field: "close"
        operator: ">"
        value: "sma_50"
      - field: "close"
        operator: ">"
        value: "sma_200"
      - field: "rsi_21"
        operator: "<"
        value: 58.0
      - field: "rsi_21"
        operator: ">"
        value: 42.0
      - field: "z_score_vwap_20"
        operator: "<"
        value: 1.5
      - field: "z_score_vwap_20"
        operator: ">"
        value: -1.5
    action:
      command: "python ./Trading/alpaca_buy_cli.py upro 5000 --mid-price --stop-loss-pct 2 --take-profit-pct 3"
    cooldown: 600

  # Trend Monitor: SPY Downtrend (Price < SMA 50 AND SMA 200)
  # Buy inverse ETF instead of shorting (cheaper, no borrow fees)
  - name: "SPY Downtrend"
    symbol: "SPY"
    asset_class: "stock"
    trigger: "bar"
    conditions:
      - field: "close"
        operator: "<"
        value: "sma_50"
      - field: "close"
        operator: "<"
        value: "sma_200"
      - field: "rsi_21"
        operator: ">"
        value: 42.0
      - field: "rsi_21"
        operator: "<"
        value: 58.0
      - field: "z_score_vwap_20"
        operator: ">"
        value: -1.5
      - field: "z_score_vwap_20"
        operator: "<"
        value: 1.5
    action:
      # Buy SPXU (3x inverse SPY) instead of shorting UPRO
      command: "python ./Trading/alpaca_buy_cli.py spxu 5000 --mid-price --stop-loss-pct 2 --take-profit-pct 3"
    cooldown: 600

  # ============================================================================
  # QQQ TREND RULES
  # ============================================================================

  # Trend Monitor: QQQ Uptrend (Price > SMA 50 AND SMA 200)
  # Only buy in confirmed uptrend with RSI in neutral zone and not overextended
  - name: "QQQ Uptrend"
    symbol: "QQQ"
    asset_class: "stock"
    trigger: "bar"
    conditions:
      - field: "close"
        operator: ">"
        value: "sma_50"
      - field: "close"
        operator: ">"
        value: "sma_200"
      - field: "rsi_21"
        operator: "<"
        value: 58.0
      - field: "rsi_21"
        operator: ">"
        value: 42.0
      - field: "z_score_vwap_20"
        operator: "<"
        value: 1.5
      - field: "z_score_vwap_20"
        operator: ">"
        value: -1.5
    action:
      command: "python ./Trading/alpaca_buy_cli.py tqqq 5000 --mid-price --stop-loss-pct 2 --take-profit-pct 3"
    cooldown: 600

  # Trend Monitor: QQQ Downtrend (Price < SMA 50 AND SMA 200)
  # Buy inverse ETF instead of shorting (cheaper, no borrow fees)
  - name: "QQQ Downtrend"
    symbol: "QQQ"
    asset_class: "stock"
    trigger: "bar"
    conditions:
      - field: "close"
        operator: "<"
        value: "sma_50"
      - field: "close"
        operator: "<"
        value: "sma_200"
      - field: "rsi_21"
        operator: ">"
        value: 42.0
      - field: "rsi_21"
        operator: "<"
        value: 58.0
      - field: "z_score_vwap_20"
        operator: ">"
        value: -1.5
      - field: "z_score_vwap_20"
        operator: "<"
        value: 1.5
    action:
      # Buy SQQQ (3x inverse QQQ) instead of shorting TQQQ
      command: "python ./Trading/alpaca_buy_cli.py sqqq 5000 --mid-price --stop-loss-pct 2 --take-profit-pct 3"
    cooldown: 600
