# MEAN REVERSION RULES - Counter-trend (Oversold + Overbought)
# Optimized for 1-MINUTE BARS
# RSI 21 = 21 minutes, Z-score 20 = 20 minutes
# Mean reversion cooldown: 45 min (2700s)
#
# RULES IN THIS FILE:
# - SPY Oversold Mean Reversion → Buy UPRO (bounce)
# - SPY Overbought Mean Reversion → Buy SPXU (pullback)
# - QQQ Oversold Mean Reversion → Buy TQQQ (bounce)
# - QQQ Overbought Mean Reversion → Buy SQQQ (pullback)

rules:
  # ============================================================================
  # SPY MEAN REVERSION RULES (Dual Confirmation: RSI + Z-Score)
  # ============================================================================

  # Mean Reversion: SPY Oversold (RSI < 22 AND z-score < -2.5)
  # Counter-trend trade: requires BOTH RSI extreme AND statistical extreme
  - name: "SPY Oversold Mean Reversion"
    symbol: "SPY"
    asset_class: "stock"
    trigger: "bar"
    conditions:
      - field: "rsi_21"
        operator: "<"
        value: 22.0
      - field: "z_score_vwap_20"
        operator: "<"
        value: -2.5
    action:
      # Extreme oversold with dual confirmation - buy the dip
      command: "python ./Trading/alpaca_buy_cli.py upro 5000 --mid-price --stop-loss-pct 2 --take-profit-pct 3"
    cooldown: 2700

  # Mean Reversion: SPY Overbought (RSI > 78 AND z-score > 2.5)
  # Counter-trend trade: requires BOTH RSI extreme AND statistical extreme
  - name: "SPY Overbought Mean Reversion"
    symbol: "SPY"
    asset_class: "stock"
    trigger: "bar"
    conditions:
      - field: "rsi_21"
        operator: ">"
        value: 78.0
      - field: "z_score_vwap_20"
        operator: ">"
        value: 2.5
    action:
      # Extreme overbought with dual confirmation - buy inverse ETF
      command: "python ./Trading/alpaca_buy_cli.py spxu 5000 --mid-price --stop-loss-pct 2 --take-profit-pct 3"
    cooldown: 2700

  # ============================================================================
  # QQQ MEAN REVERSION RULES (Dual Confirmation: RSI + Z-Score)
  # ============================================================================

  # Mean Reversion: QQQ Oversold (RSI < 22 AND z-score < -2.5)
  # Counter-trend trade: requires BOTH RSI extreme AND statistical extreme
  - name: "QQQ Oversold Mean Reversion"
    symbol: "QQQ"
    asset_class: "stock"
    trigger: "bar"
    conditions:
      - field: "rsi_21"
        operator: "<"
        value: 22.0
      - field: "z_score_vwap_20"
        operator: "<"
        value: -2.5
    action:
      # Extreme oversold with dual confirmation - buy the dip
      command: "python ./Trading/alpaca_buy_cli.py tqqq 5000 --mid-price --stop-loss-pct 2 --take-profit-pct 3"
    cooldown: 2700

  # Mean Reversion: QQQ Overbought (RSI > 78 AND z-score > 2.5)
  # Counter-trend trade: requires BOTH RSI extreme AND statistical extreme
  - name: "QQQ Overbought Mean Reversion"
    symbol: "QQQ"
    asset_class: "stock"
    trigger: "bar"
    conditions:
      - field: "rsi_21"
        operator: ">"
        value: 78.0
      - field: "z_score_vwap_20"
        operator: ">"
        value: 2.5
    action:
      # Extreme overbought with dual confirmation - buy inverse ETF
      command: "python ./Trading/alpaca_buy_cli.py sqqq 5000 --mid-price --stop-loss-pct 2 --take-profit-pct 3"
    cooldown: 2700
