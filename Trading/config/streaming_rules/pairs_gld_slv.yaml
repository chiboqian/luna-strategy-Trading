# Pairs Trading: GLD (Gold) vs SLV (Silver)
# The "Gold/Silver Ratio" Trade (Mean Reversion).
#
# STRATEGY:
# - If GLD is expensive vs SLV (Ratio Z > 2.0) -> Short GLD / Long SLV.
# - If GLD is cheap vs SLV (Ratio Z < -2.0) -> Long GLD / Short SLV.
#
# NOTE: We use Standard Short Selling here (no liquid Inverse ETFs).

rules:
  # ----------------------------------------------------------------------------
  # SCENARIO: GOLD IS EXPENSIVE (Ratio Z > 2.0)
  # Trade: Short GLD / Long SLV
  # ----------------------------------------------------------------------------
  - name: "Pair Entry: Short GLD / Long SLV"
    asset_class: "stock"
    symbol: "GLD" # Trigger on GLD
    trigger: "bar"
    conditions:
      - field: "z_score_ratio_GLD_SLV_20"
        operator: ">"
        value: 2.0
    action:
      # Short GLD, Long SLV.
      command: "python ./Trading/alpaca_pairs_cli.py --long SLV --short GLD --capital 10000 --action open --check-position"
    cooldown: 7200

  # ----------------------------------------------------------------------------
  # SCENARIO: GOLD IS CHEAP (Ratio Z < -2.0)
  # Trade: Long GLD / Short SLV
  # ----------------------------------------------------------------------------
  - name: "Pair Entry: Long GLD / Short SLV"
    asset_class: "stock"
    symbol: "GLD"
    trigger: "bar"
    conditions:
      - field: "z_score_ratio_GLD_SLV_20"
        operator: "<"
        value: -2.0
    action:
      # Long GLD, Short SLV.
      command: "python ./Trading/alpaca_pairs_cli.py --long GLD --short SLV --capital 10000 --action open --check-position"
    cooldown: 7200

  # ----------------------------------------------------------------------------
  # PAIR EXIT: NORMALIZE
  # ----------------------------------------------------------------------------
  - name: "Pair Exit: GLD/SLV Normalize"
    asset_class: "stock"
    symbol: "GLD"
    trigger: "bar"
    conditions:
      - field: "z_score_ratio_GLD_SLV_20"
        operator: "<"
        value: 0.5
      - field: "z_score_ratio_GLD_SLV_20"
        operator: ">"
        value: -0.5
      # Only exit if we have a position
      - field: "position_qty"
        operator: "abs>"
        value: 0
    action:
      command: "python ./Trading/alpaca_pairs_cli.py --long GLD --short SLV --action close-all"
    cooldown: 3600

  # ----------------------------------------------------------------------------
  # STOP LOSS: BLOWOUT
  # ----------------------------------------------------------------------------
  - name: "Pair Stop: Blowout (Z > 3.5)"
    asset_class: "stock"
    symbol: "GLD"
    trigger: "bar"
    conditions:
      - field: "z_score_ratio_GLD_SLV_20"
        operator: ">"
        value: 3.5
      - field: "position_qty"
        operator: "abs>"
        value: 0
    action:
      command: "python ./Trading/alpaca_pairs_cli.py --long GLD --short SLV --action close-all"
    cooldown: 3600

  - name: "Pair Stop: Blowout (Z < -3.5)"
    asset_class: "stock"
    symbol: "GLD"
    trigger: "bar"
    conditions:
      - field: "z_score_ratio_GLD_SLV_20"
        operator: "<"
        value: -3.5
      - field: "position_qty"
        operator: "abs>"
        value: 0
    action:
      command: "python ./Trading/alpaca_pairs_cli.py --long GLD --short SLV --action close-all"
    cooldown: 3600
