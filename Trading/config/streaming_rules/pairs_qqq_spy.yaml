# Pairs Trading: QQQ vs SPY (Risk-On / Risk-Off Rotation)
# Uses 1x Inverse ETFs to avoid short selling borrowing costs.
# - PSQ = Short QQQ
# - SH  = Short SPY

rules:
  # ----------------------------------------------------------------------------
  # PAIR ENTRY: LONG TECH / SHORT MARKET
  # Logic: QQQ is Strong relative to SPY.
  # Trade: Long QQQ + Long SH (Short SPY proxy)
  # ----------------------------------------------------------------------------
  - name: "Pair Entry: Long QQQ / Short SPY (via SH)"
    asset_class: "stock"
    symbol: "QQQ" 
    trigger: "bar"
    conditions:
      - field: "z_score_vwap_20"
        operator: ">"
        value: 1.5
    action:
      # We buy QQQ and SH (Short SPY). Capital split 50/50.
      command: "python ./Trading/alpaca_pairs_cli.py --long QQQ --short SH --capital 10000 --action open --type long-long"
    cooldown: 3600

  # ----------------------------------------------------------------------------
  # PAIR ENTRY: SHORT TECH / LONG MARKET
  # Logic: QQQ is Weak relative to SPY.
  # Trade: Long PSQ (Short QQQ proxy) + Long SPY
  # ----------------------------------------------------------------------------
  - name: "Pair Entry: Short QQQ (via PSQ) / Long SPY"
    asset_class: "stock"
    symbol: "QQQ"
    trigger: "bar"
    conditions:
      - field: "z_score_vwap_20"
        operator: "<"
        value: -1.5
    action:
      # We buy PSQ (Short QQQ) and SPY. Capital split 50/50.
      command: "python ./Trading/alpaca_pairs_cli.py --long SPY --short PSQ --capital 10000 --action open --type long-long"
    cooldown: 3600

  # ----------------------------------------------------------------------------
  # PAIR EXIT: NORMALIZE
  # ----------------------------------------------------------------------------
  - name: "Pair Exit: QQQ/SPY Normalize"
    asset_class: "stock"
    symbol: "QQQ"
    trigger: "bar"
    conditions:
      - field: "z_score_vwap_20"
        operator: "<"
        value: 0.5
      - field: "z_score_vwap_20"
        operator: ">"
        value: -0.5
    action:
      # Close ALL positions related to this pair
      command: "python ./Trading/alpaca_pairs_cli.py --long QQQ --short SH --long2 SPY --short2 PSQ --action close-all"
    cooldown: 3600
